var We=Object.defineProperty,De=Object.defineProperties;var Le=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var ae=(e,t,n)=>t in e?We(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,f=(e,t)=>{for(var n in t||(t={}))ie.call(t,n)&&ae(e,n,t[n]);if(F)for(var n of F(t))se.call(t,n)&&ae(e,n,t[n]);return e},u=(e,t)=>De(e,Le(t));var ce=(e,t)=>{var n={};for(var r in e)ie.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&F)for(var r of F(e))t.indexOf(r)<0&&se.call(e,r)&&(n[r]=e[r]);return n};var de=(e,t,n)=>new Promise((r,o)=>{var s=i=>{try{a(n.next(i))}catch(m){o(m)}},c=i=>{try{a(n.throw(i))}catch(m){o(m)}},a=i=>i.done?r(i.value):Promise.resolve(i.value).then(s,c);a((n=n.apply(e,t)).next())});import{forwardRef as Ue,useRef as ze,useState as Ve,useMemo as J}from"react";import{createContext as pe}from"react";var Ee={loading:!1,venueLayoutId:void 0,sectionByIdMap:new Map,rowByIdMap:new Map,sectionByNameMap:new Map,rowBySectionIdRowNameMap:new Map},Oe={level:"section"},k={layout:Ee,settings:Oe};var A=pe(k),C=pe(void 0);import qe from"@onlocation/venue-map";import{useContext as me}from"react";import{jsx as le}from"react/jsx-runtime";var Ge=({levelWrapperClassName:e,onLevelChange:t})=>{let{settings:{level:n}}=me(A),r=me(C);return le("div",{className:e,children:le("button",{onClick:o=>{if(o.preventDefault(),o.stopPropagation(),typeof r=="function"){let s=n==="row"?"section":"row";r(c=>u(f({},c),{settings:u(f({},c.settings),{level:s})})),typeof t=="function"&&t(s)}},children:n==="row"?"Sections":"Rows"})})},V=Ge;import{useEffect as $e,useContext as ye}from"react";var ue=e=>{let t={sectionByIdMap:new Map,rowByIdMap:new Map,sectionByNameMap:new Map,rowBySectionIdRowNameMap:new Map};if(e!=null&&e.length)for(let n=0;n<e.length;n++){let r=e[n],{coordinates:o,type:s}=r.shape||{};if(s==="MultiPolygon"&&(o!=null&&o.length)){let a=u(f({},r),{multiPolygon:o.flat()});t.sectionByIdMap.set(r.id,a),Array.from(new Set([r.name,...r.sectionAliases||[]])).forEach(i=>{t.sectionByNameMap.set(i,a)})}let{rows:c=[]}=r;if(c.length)for(let a=0;a<c.length;a++){let i=c[a],{coordinates:m,type:I}=i.shape||{};if(I==="MultiPolygon"&&(m!=null&&m.length)){let M=u(f({},i),{multiPolygon:m.flat()});t.rowByIdMap.set(i.id,M),Array.from(new Set([i.name,...i.rowAliases||[]])).forEach(w=>{t.rowBySectionIdRowNameMap.set(`${r.id}_${w}`,M)})}}}return t},_e=(e,t,n)=>n.filter(r=>{var o;return r.rowId===e.id?!0:!!((e.name===r.rowName||(o=e.rowAliases)!=null&&o.includes(r.rowName||""))&&t.includes(r.sectionName||""))}),Fe=(e,t)=>t.filter(n=>{var r;return n.sectionId===e.id?!0:!!(e.name===n.sectionName||(r=e.sectionAliases)!=null&&r.includes(n.sectionName||""))}),Ie=(e,t,n)=>{let{rowByIdMap:r,sectionByIdMap:o}=t,s=r.get(e),c=o.get(e);if(s){let a=o.get(s.sectionId),i=a?[a.name,...a.sectionAliases||[]]:[];return _e(s,i,n).sort((m,I)=>(I.sortOrder||0)-(m.sortOrder||0))[0]}else if(c)return Fe(c,n).sort((a,i)=>(i.sortOrder||0)-(a.sortOrder||0))[0]},fe=(e,t)=>{if(e)return(e.sectionId?t.sectionByIdMap.get(e.sectionId):void 0)||(e.sectionName?t.sectionByNameMap.get(e.sectionName):void 0)},$=(e,t,n)=>{if(e)switch(n){case"row":{let r=fe(e,t);if(!r)return;let o=(e.rowId?t.rowByIdMap.get(e.rowId):void 0)||(e.rowName?t.rowBySectionIdRowNameMap.get(`${r.id}_${e.rowName}`):void 0);return o?o.id:void 0}case"section":{let r=fe(e,t);return r?r.id:void 0}}},W=(e,t,n)=>{let r={};if(!e)return r;switch(n){case"row":{let o=t.rowByIdMap.get(e),s=o?t.sectionByIdMap.get(o.sectionId):void 0;o&&s&&(r.mapItemIdentifies={sectionId:s==null?void 0:s.id,sectionName:s==null?void 0:s.name,rowId:o.id,rowName:o.name,aliases:o.rowAliases},r.mappedRow=o,r.mappedSection=s);break}case"section":{let o=t.sectionByIdMap.get(e);o&&(r.mapItemIdentifies={sectionId:o.id,sectionName:o.name,rowId:void 0,rowName:void 0,aliases:o.sectionAliases},r.mappedSection=o);break}}return r};var He=({venueLayoutId:e,token:t})=>{let n=ye(A),r=ye(C),o=s=>de(null,null,function*(){if(typeof r=="function")try{if(!t)throw new Error("");r(a=>u(f({},a),{layout:u(f({},a.layout),{loading:!0})}));let c=yield fetch(`https://stage-api.vpc.qcue.com/venue/public/venuelayouts/${s}/sections?deep=true`,{headers:{authorization:`Bearer ${t}`},method:"GET"});if(c.ok){let a=yield c.json();r(u(f({},k),{layout:u(f({},ue(a)),{loading:!1,venueLayoutId:s})}))}else throw new Error}catch(c){r(a=>u(f({},a),{layout:u(f({},a.layout),{loading:!1})})),console.error(`Map Error: Error getting sections for the venueLayoutId - ${s}`)}});return $e(()=>{typeof r=="function"&&(!e||!t?r(k):e!==n.layout.venueLayoutId&&o(e))},[e,t]),null},q=He;import{useMemo as Me}from"react";var we=(e,t,n)=>{let{layout:r,settings:o}=t,s=n||o.level,c=Me(()=>s==="row"?Array.from(r.rowByIdMap.values()):Array.from(r.sectionByIdMap.values()),[r,s]);return Me(()=>c.map(a=>{let i=Ie(a.id,r,e);return{id:a.id,multiPolygon:a.multiPolygon,inactiveStyles:i==null?void 0:i.inactiveStyles,activeStyles:i==null?void 0:i.activeStyles,noninteractive:i==null?void 0:i.noninteractive,tooltip:n==="row"?i==null?void 0:i.rowTooltip:i==null?void 0:i.sectionTooltip,interactive:!!i,fillPattern:i==null?void 0:i.fillPattern}}),[c,r,e])};import{Fragment as Ye,jsx as D,jsxs as Ze}from"react/jsx-runtime";var Je=Ue((e,t)=>{let te=e,{token:n,venueLayoutId:r,items:o=[],extraContent:s,level:c,hoveredItem:a,focusedItem:i,selectedItems:m,onItemHover:I,onItemClick:M,onItemsSelect:w,onLevelChange:z,defaultExtraContentOptions:d}=te,l=ce(te,["token","venueLayoutId","items","extraContent","level","hoveredItem","focusedItem","selectedItems","onItemHover","onItemClick","onItemsSelect","onLevelChange","defaultExtraContentOptions"]),[p,g]=Ve(k),P=ze(null),S=we(o,p,c),G=J(()=>$(a,p.layout,p.settings.level),[a,p.layout,p.settings.level]),R=J(()=>$(i,p.layout,p.settings.level),[i,p.layout,p.settings.level]),N=J(()=>Array.from(new Set(m==null?void 0:m.reduce((y,v)=>{let _=$(v,p.layout,p.settings.level);return _&&y.push(_),y},[]))),[m,p.layout,p.settings.level]),Ne=y=>{if(typeof I=="function")if(y){let{mapItemIdentifies:v}=W(y,p.layout,p.settings.level);I(v)}else I()},be=y=>{if(typeof M!="function")return;let{mapItemIdentifies:v}=W(y,p.layout,p.settings.level);v&&M(v)},Be=(y,v)=>{if(typeof w!="function")return;let _=v.reduce((re,Re)=>{let{mapItemIdentifies:ne}=W(Re,p.layout,p.settings.level);return ne&&re.push(ne),re},[]),{mapItemIdentifies:oe}=W(y,p.layout,p.settings.level);oe&&w(oe,_)};return D(A.Provider,{value:p,children:D(C.Provider,{value:g,children:Ze(Ye,{children:[D(q,{venueLayoutId:r,token:n}),D(qe,u(f({},l),{ref:y=>{P.current=y,t&&(typeof t=="function"?t(y):t.current=y)},defaultExtraContentOptions:d,extraContent:u(f({},s),{"top-center":d!==!1&&(d==null?void 0:d.level)!==!1?{component:D(V,{onLevelChange:z,levelWrapperClassName:d==null?void 0:d.levelWrapperClassName})}:void 0}),background:{venueLayoutId:r},items:S,hoverId:G,focusId:R,selectIds:N,onItemHover:Ne,onItemClick:be,onItemSelect:Be}))]})})})}),L=Je;import Mt from"react-dom/client";import{useMemo as Ae,useState as U}from"react";var Ke={id:1,watermarkName:"Green",color:"lightgreen",sortOrder:1},ge={id:2,watermarkName:"Red",color:"red",sortOrder:2},E={id:3,watermarkName:"Blue",color:"lightblue",sortOrder:3},h=[{id:1,section:"1",row:"1",watermarks:[Ke]},{id:2,section:"1",row:"2",watermarks:[ge]},{id:3,section:"2",row:"1"},{id:4,section:"3",row:"1"},{id:5,section:"7",row:"1",watermarks:[E]},{id:6,section:"7",row:"2",watermarks:[E]},{id:7,section:"7",row:"3",watermarks:[E]},{id:8,section:"7",row:"4",watermarks:[E]},{id:9,section:"8",row:"1",watermarks:[ge,E]}];import Qe from"styled-components";var Xe=Qe.div`
  display: flex;
  gap: 6px;
  align-items: center;
  min-width: 100px;

  .color {
    display: block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: red;
  }
`,H=Xe;import{jsx as et,jsxs as Se}from"react/jsx-runtime";var je=({color:e,name:t})=>Se(H,{children:[et("div",{className:"color",style:{backgroundColor:e}}),Se("div",{children:["Row: ",t]})]}),Y=je;import{jsx as ve,jsxs as ke}from"react/jsx-runtime";var tt=({color:e,name:t})=>ke(H,{children:[ve("div",{className:"color",style:{backgroundColor:e}}),ve("div",{children:ke("div",{children:["Section: ",t]})})]}),Z=tt;import{jsx as rt,jsxs as x}from"react/jsx-runtime";var ot=({ticket:e,active:t,onClick:n,onHover:r})=>{let{watermarks:o}=e;return x("div",{style:{margin:"10px 0",border:"2px solid transparent",borderColor:t?"red":"transparent",overflow:"auto"},onMouseEnter:()=>r({sectionName:e.section,rowName:e.row}),onMouseLeave:()=>r(void 0),onClick:()=>n({sectionName:e.section,rowName:e.row}),children:[x("strong",{children:["Ticket ID: ",e.id]}),x("div",{children:["Section: ",`${e.section}`]}),x("div",{children:["Row: ",`${e.row}`]}),x("div",{children:["Section ID: ",`${e.sectionId}`]}),x("div",{children:["Row ID: ",`${e.rowId}`]}),o&&o.length>0&&o.sort((s,c)=>s.sortOrder-c.sortOrder).map(s=>x("div",{style:{marginLeft:10,display:"flex",alignItems:"center",gap:6,fontSize:"12px"},children:[rt("div",{style:{width:"10px",height:"10px",borderRadius:"50%",backgroundColor:s.color}}),x("div",{children:[s.watermarkName," (",s.sortOrder,")"]})]},s.id))]})},K=ot;import{jsx as b,jsxs as T}from"react/jsx-runtime";var nt=({tickets:e,onHover:t,onClick:n,setToken:r,actionState:o,selectedTickets:s})=>{var c,a,i,m;return T("div",{style:{width:"300px",height:"100%",borderRight:"3px dashed gray",overflow:"auto",fontSize:"12px"},children:[T("div",{children:[b("h4",{style:{fontSize:"16px",margin:"10px"},children:"Token"}),b("input",{type:"password",onChange:({target:{value:I}})=>r(I)})]}),b("h4",{style:{fontSize:"16px",margin:"10px"},children:"Tickets"}),T("div",{children:[b("strong",{children:"Hover:"}),T("div",{children:["Section: ",`${(c=o.hover)==null?void 0:c.sectionName}`]}),T("div",{children:["Row: ",`${(a=o.hover)==null?void 0:a.rowName}`]})]}),T("div",{children:[b("strong",{children:"Focus:"}),T("div",{children:["Section: ",`${(i=o.focus)==null?void 0:i.sectionName}`]}),T("div",{children:["Row: ",`${(m=o.focus)==null?void 0:m.rowName}`]})]}),e.filter(I=>s.length?s.includes(I.id):!0).map(I=>{let M=!1,w=o.focus||o.hover;return w&&(!w.rowName&&I.section===w.sectionName||w.rowName===I.row&&w.sectionName===I.section)&&(M=!0),b(K,{active:M,ticket:I,onClick:n,onHover:t},I.id)})]})},Q=nt;import{useEffect as ct,useState as dt}from"react";import at from"styled-components";var it=at.div`
  display: flex;
  gap: 8px;
`,he=it;var st=(e,t)=>{let n=t.filter(s=>s.section===e.section),r=[],o=[];return n.forEach(s=>{var c;if((c=s.watermarks)!=null&&c.length)for(let a=0;a<s.watermarks.length;a++){let i=s.watermarks[a];r.includes(i.id)||(r.push(i.id),o.push(i))}}),o},xe=e=>e!=null&&e.length?e.sort((t,n)=>t.sortOrder-n.sortOrder)[0].color:X,O=e=>{var n;let t={ticketsByIdMap:new Map,sectionDataByIdMap:new Map,rowDataByIdMap:new Map,watermarks:[],ticketsByWatermarkIdMap:new Map,watermarksByIdMap:new Map,sectionRowIdsByWatermarkIdMap:new Map};if(e!=null&&e.length)for(let r=0;r<e.length;r++){let o=e[r],s=st(o,e);if(t.ticketsByIdMap.set(o.id,o),t.sectionDataByIdMap.set(o.sectionId,{color:xe(s),sectionId:o.sectionId,rowId:o.rowId}),t.rowDataByIdMap.set(o.rowId,{color:xe(o.watermarks),sectionId:o.sectionId,rowId:o.rowId}),(n=o.watermarks)!=null&&n.length)for(let c=0;c<o.watermarks.length;c++){let a=o.watermarks[c],i=t.ticketsByWatermarkIdMap.get(a.id);i?t.ticketsByWatermarkIdMap.set(a.id,[...i,o]):t.ticketsByWatermarkIdMap.set(a.id,[o]),t.watermarksByIdMap.has(a.id)||t.watermarksByIdMap.set(a.id,a);let m=t.sectionRowIdsByWatermarkIdMap.get(a.id);m?t.sectionRowIdsByWatermarkIdMap.set(a.id,{sectionIds:Array.from(new Set(o.sectionId?[...m.sectionIds,o.sectionId]:m.sectionIds)),rowIds:Array.from(new Set(o.rowId?[...m.rowIds,o.rowId]:m.rowIds))}):t.sectionRowIdsByWatermarkIdMap.set(a.id,{sectionIds:o.sectionId?[o.sectionId]:[],rowIds:o.rowId?[o.rowId]:[]})}}return t.watermarks=Array.from(t.watermarksByIdMap.values()),t};import{Fragment as mt,jsx as Te,jsxs as lt}from"react/jsx-runtime";var pt=({tickets:e,onSelect:t})=>{let[{watermarks:n},r]=dt(O(e)),o=c=>{c.preventDefault(),c.stopPropagation()},s=(c,a)=>{o(c),t(a)};return ct(()=>{r(O(e))},[e]),n.length?Te(he,{children:n.map(c=>lt("button",{style:{backgroundColor:c.color,display:"flex",alignItems:"center",gap:4},onDoubleClick:o,onDoubleClickCapture:o,onClick:a=>s(a,c),children:[c.watermarkName," (",c.sortOrder,")"]},c.id))}):Te(mt,{})},j=pt;import ft from"styled-components";var ut=ft.div`
  .level-wrapper {
    // padding: 14px;
    // margin-top: 30px;
    // &>button {
    //   font-size: 40px;
    // }
    background-color: red;
  }
`,Pe=ut;import{jsx as B,jsxs as yt}from"react/jsx-runtime";var X="#CABF93",It=()=>{let[e,t]=U(O(h)),[n,r]=U({hover:void 0,focus:void 0,selected:[],selectedWatermark:void 0}),[o,s]=U("section"),[c,a]=U(""),i=Ae(()=>{var d;return n.selectedWatermark?((d=e.ticketsByWatermarkIdMap.get(n.selectedWatermark.id))==null?void 0:d.map(l=>l.id))||[]:h.filter(l=>n.selected.some(p=>p.rowName?l.row===p.rowName&&l.section===p.sectionName:l.section===p.sectionName)).map(l=>l.id)},[n.selected,n.selectedWatermark]),m=Ae(()=>h.map((d,l)=>{var S,G;let p=n.selectedWatermark&&((S=d.watermarks)!=null&&S.length)?d.watermarks.find(R=>{var N;return R.id===((N=n.selectedWatermark)==null?void 0:N.id)}):void 0,g=p||((G=d.watermarks)!=null&&G.length?d.watermarks.sort((R,N)=>(R.sortOrder||0)-(N.sortOrder||0))[0]:void 0),P=(g==null?void 0:g.color)||X;return{sectionName:d.section,rowName:d.row,inactiveStyles:{fillColor:p==null?void 0:p.color},sortOrder:(p==null?void 0:p.sortOrder)||void 0,rowTooltip:B(Y,{color:P,name:d.row}),sectionTooltip:B(Z,{color:P,name:d.section})}}),[h,n.selectedWatermark]),I=d=>{n!=null&&n.focus||r(l=>u(f({},l),{hover:d}))},M=d=>{r(l=>u(f({},l),{focus:JSON.stringify(d)===JSON.stringify(l.focus)?void 0:d,hover:void 0}))},w=d=>{console.log(d.length,h.length),r(l=>u(f({},l),{selected:d,selectedWatermark:void 0}))},z=d=>{r(l=>{var p,g,P;return u(f({},l),{selected:((p=l.selectedWatermark)==null?void 0:p.id)===d.id?[]:((g=e.ticketsByWatermarkIdMap.get(d.id))==null?void 0:g.map(S=>u(f({},S),{sectionName:S.section,rowName:S.row})))||[],selectedWatermark:((P=l.selectedWatermark)==null?void 0:P.id)===d.id?void 0:d})})};return yt("div",{style:{display:"flex",height:"900px"},children:[B(Q,{tickets:h,selectedTickets:i,actionState:n,onHover:I,onClick:M,setToken:d=>a(d)}),B(Pe,{style:{flex:"auto",height:"100%"},children:B(L,{level:o,onLevelChange:s,venueLayoutId:560501,token:c,items:m,hoveredItem:n.hover||void 0,focusedItem:n.focus||void 0,selectedItems:n.selected||void 0,defaultExtraContentOptions:{levelWrapperClassName:"level-wrapper"},extraContent:{"bottom-left":{component:B(j,{tickets:h,onSelect:z})}},useShadeDown:["select"],useMapSelect:!0,onItemHover:d=>{I(d)},onItemClick:d=>{M(d)},onItemsSelect:(d,l)=>{console.log("map selection: ",d,l),w(l)},defaultItemStyles:{interactive:{inactive:{fillColor:"#CABF93",fillOpacity:1},active:{fillColor:"#CABF93",fillOpacity:1,color:"black",opacity:1,weight:2}},noninteractive:{fillColor:"lightgray"}}})})]})},ee=It;import{jsx as wt}from"react/jsx-runtime";function Ce(){let e=document.getElementById("root");if(!e)throw new Error("Root element not found");Mt.createRoot(e).render(wt(ee,{}))}var vr=L;Ce();export{vr as default};
