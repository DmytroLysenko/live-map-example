"use strict";var Fe=Object.create;var O=Object.defineProperty,$e=Object.defineProperties,He=Object.getOwnPropertyDescriptor,Ue=Object.getOwnPropertyDescriptors,ze=Object.getOwnPropertyNames,J=Object.getOwnPropertySymbols,Ve=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var ye=(e,t,r)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,f=(e,t)=>{for(var r in t||(t={}))X.call(t,r)&&ye(e,r,t[r]);if(J)for(var r of J(t))Me.call(t,r)&&ye(e,r,t[r]);return e},u=(e,t)=>$e(e,Ue(t));var we=(e,t)=>{var r={};for(var n in e)X.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&J)for(var n of J(e))t.indexOf(n)<0&&Me.call(e,n)&&(r[n]=e[n]);return r};var qe=(e,t)=>{for(var r in t)O(e,r,{get:t[r],enumerable:!0})},ge=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ze(t))!X.call(e,o)&&o!==r&&O(e,o,{get:()=>t[o],enumerable:!(n=He(t,o))||n.enumerable});return e};var G=(e,t,r)=>(r=e!=null?Fe(Ve(e)):{},ge(t||!e||!e.__esModule?O(r,"default",{value:e,enumerable:!0}):r,e)),Je=e=>ge(O({},"__esModule",{value:!0}),e);var Se=(e,t,r)=>new Promise((n,o)=>{var s=i=>{try{a(r.next(i))}catch(m){o(m)}},c=i=>{try{a(r.throw(i))}catch(m){o(m)}},a=i=>i.done?n(i.value):Promise.resolve(i.value).then(s,c);a((r=r.apply(e,t)).next())});var ft={};qe(ft,{default:()=>lt});module.exports=Je(ft);var k=require("react");var j=require("react");var Ye={loading:!1,venueLayoutId:void 0,sectionByIdMap:new Map,rowByIdMap:new Map,sectionByNameMap:new Map,rowBySectionIdRowNameMap:new Map},Ze={level:"section"},A={layout:Ye,settings:Ze};var B=(0,j.createContext)(A),R=(0,j.createContext)(void 0);var Te=G(require("@onlocation/venue-map"));var ee=require("react");var te=require("react/jsx-runtime"),Ke=({levelWrapperClassName:e,onLevelChange:t})=>{let{settings:{level:r}}=(0,ee.useContext)(B),n=(0,ee.useContext)(R);return(0,te.jsx)("div",{className:e,children:(0,te.jsx)("button",{onClick:o=>{if(o.preventDefault(),o.stopPropagation(),typeof n=="function"){let s=r==="row"?"section":"row";n(c=>u(f({},c),{settings:u(f({},c.settings),{level:s})})),typeof t=="function"&&t(s)}},children:r==="row"?"Sections":"Rows"})})},oe=Ke;var F=require("react");var ke=e=>{let t={sectionByIdMap:new Map,rowByIdMap:new Map,sectionByNameMap:new Map,rowBySectionIdRowNameMap:new Map};if(e!=null&&e.length)for(let r=0;r<e.length;r++){let n=e[r],{coordinates:o,type:s}=n.shape||{};if(s==="MultiPolygon"&&(o!=null&&o.length)){let a=u(f({},n),{multiPolygon:o.flat()});t.sectionByIdMap.set(n.id,a),Array.from(new Set([n.name,...n.sectionAliases||[]])).forEach(i=>{t.sectionByNameMap.set(i,a)})}let{rows:c=[]}=n;if(c.length)for(let a=0;a<c.length;a++){let i=c[a],{coordinates:m,type:I}=i.shape||{};if(I==="MultiPolygon"&&(m!=null&&m.length)){let w=u(f({},i),{multiPolygon:m.flat()});t.rowByIdMap.set(i.id,w),Array.from(new Set([i.name,...i.rowAliases||[]])).forEach(g=>{t.rowBySectionIdRowNameMap.set(`${n.id}_${g}`,w)})}}}return t},Qe=(e,t,r)=>r.filter(n=>{var o;return n.rowId===e.id?!0:!!((e.name===n.rowName||(o=e.rowAliases)!=null&&o.includes(n.rowName||""))&&t.includes(n.sectionName||""))}),Xe=(e,t)=>t.filter(r=>{var n;return r.sectionId===e.id?!0:!!(e.name===r.sectionName||(n=e.sectionAliases)!=null&&n.includes(r.sectionName||""))}),he=(e,t,r)=>{let{rowByIdMap:n,sectionByIdMap:o}=t,s=n.get(e),c=o.get(e);if(s){let a=o.get(s.sectionId),i=a?[a.name,...a.sectionAliases||[]]:[];return Qe(s,i,r).sort((m,I)=>(I.sortOrder||0)-(m.sortOrder||0))[0]}else if(c)return Xe(c,r).sort((a,i)=>(i.sortOrder||0)-(a.sortOrder||0))[0]},ve=(e,t)=>{if(e)return(e.sectionId?t.sectionByIdMap.get(e.sectionId):void 0)||(e.sectionName?t.sectionByNameMap.get(e.sectionName):void 0)},Y=(e,t,r)=>{if(e)switch(r){case"row":{let n=ve(e,t);if(!n)return;let o=(e.rowId?t.rowByIdMap.get(e.rowId):void 0)||(e.rowName?t.rowBySectionIdRowNameMap.get(`${n.id}_${e.rowName}`):void 0);return o?o.id:void 0}case"section":{let n=ve(e,t);return n?n.id:void 0}}},_=(e,t,r)=>{let n={};if(!e)return n;switch(r){case"row":{let o=t.rowByIdMap.get(e),s=o?t.sectionByIdMap.get(o.sectionId):void 0;o&&s&&(n.mapItemIdentifies={sectionId:s==null?void 0:s.id,sectionName:s==null?void 0:s.name,rowId:o.id,rowName:o.name,aliases:o.rowAliases},n.mappedRow=o,n.mappedSection=s);break}case"section":{let o=t.sectionByIdMap.get(e);o&&(n.mapItemIdentifies={sectionId:o.id,sectionName:o.name,rowId:void 0,rowName:void 0,aliases:o.sectionAliases},n.mappedSection=o);break}}return n};var je=({venueLayoutId:e,token:t})=>{let r=(0,F.useContext)(B),n=(0,F.useContext)(R),o=s=>Se(null,null,function*(){if(typeof n=="function")try{if(!t)throw new Error("");n(a=>u(f({},a),{layout:u(f({},a.layout),{loading:!0})}));let c=yield fetch(`https://stage-api.vpc.qcue.com/venue/public/venuelayouts/${s}/sections?deep=true`,{headers:{authorization:`Bearer ${t}`},method:"GET"});if(c.ok){let a=yield c.json();n(u(f({},A),{layout:u(f({},ke(a)),{loading:!1,venueLayoutId:s})}))}else throw new Error}catch(c){n(a=>u(f({},a),{layout:u(f({},a.layout),{loading:!1})})),console.error(`Map Error: Error getting sections for the venueLayoutId - ${s}`)}});return(0,F.useEffect)(()=>{typeof n=="function"&&(!e||!t?n(A):e!==r.layout.venueLayoutId&&o(e))},[e,t]),null},re=je;var ne=require("react");var xe=(e,t,r)=>{let{layout:n,settings:o}=t,s=r||o.level,c=(0,ne.useMemo)(()=>s==="row"?Array.from(n.rowByIdMap.values()):Array.from(n.sectionByIdMap.values()),[n,s]);return(0,ne.useMemo)(()=>c.map(a=>{let i=he(a.id,n,e);return{id:a.id,multiPolygon:a.multiPolygon,inactiveStyles:i==null?void 0:i.inactiveStyles,activeStyles:i==null?void 0:i.activeStyles,noninteractive:i==null?void 0:i.noninteractive,tooltip:r==="row"?i==null?void 0:i.rowTooltip:i==null?void 0:i.sectionTooltip,interactive:!!i,fillPattern:i==null?void 0:i.fillPattern}}),[c,n,e])};var v=require("react/jsx-runtime"),et=(0,k.forwardRef)((e,t)=>{let le=e,{token:r,venueLayoutId:n,items:o=[],extraContent:s,level:c,hoveredItem:a,focusedItem:i,selectedItems:m,onItemHover:I,onItemClick:w,onItemsSelect:g,onLevelChange:Q,defaultExtraContentOptions:d}=le,l=we(le,["token","venueLayoutId","items","extraContent","level","hoveredItem","focusedItem","selectedItems","onItemHover","onItemClick","onItemsSelect","onLevelChange","defaultExtraContentOptions"]),[p,x]=(0,k.useState)(A),b=(0,k.useRef)(null),T=xe(o,p,c),V=(0,k.useMemo)(()=>Y(a,p.layout,p.settings.level),[a,p.layout,p.settings.level]),E=(0,k.useMemo)(()=>Y(i,p.layout,p.settings.level),[i,p.layout,p.settings.level]),D=(0,k.useMemo)(()=>Array.from(new Set(m==null?void 0:m.reduce((M,P)=>{let q=Y(P,p.layout,p.settings.level);return q&&M.push(q),M},[]))),[m,p.layout,p.settings.level]),Ee=M=>{if(typeof I=="function")if(M){let{mapItemIdentifies:P}=_(M,p.layout,p.settings.level);I(P)}else I()},Oe=M=>{if(typeof w!="function")return;let{mapItemIdentifies:P}=_(M,p.layout,p.settings.level);P&&w(P)},Ge=(M,P)=>{if(typeof g!="function")return;let q=P.reduce((ue,_e)=>{let{mapItemIdentifies:Ie}=_(_e,p.layout,p.settings.level);return Ie&&ue.push(Ie),ue},[]),{mapItemIdentifies:fe}=_(M,p.layout,p.settings.level);fe&&g(fe,q)};return(0,v.jsx)(B.Provider,{value:p,children:(0,v.jsx)(R.Provider,{value:x,children:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(re,{venueLayoutId:n,token:r}),(0,v.jsx)(Te.default,u(f({},l),{ref:M=>{b.current=M,t&&(typeof t=="function"?t(M):t.current=M)},defaultExtraContentOptions:d,extraContent:u(f({},s),{"top-center":d!==!1&&(d==null?void 0:d.level)!==!1?{component:(0,v.jsx)(oe,{onLevelChange:Q,levelWrapperClassName:d==null?void 0:d.levelWrapperClassName})}:void 0}),background:{venueLayoutId:n},items:T,hoverId:V,focusId:E,selectIds:D,onItemHover:Ee,onItemClick:Oe,onItemSelect:Ge}))]})})})}),$=et;var We=G(require("react-dom/client"));var N=require("react");var tt={id:1,watermarkName:"Green",color:"lightgreen",sortOrder:1},Pe={id:2,watermarkName:"Red",color:"red",sortOrder:2},H={id:3,watermarkName:"Blue",color:"lightblue",sortOrder:3},C=[{id:1,section:"1",row:"1",watermarks:[tt]},{id:2,section:"1",row:"2",watermarks:[Pe]},{id:3,section:"2",row:"1"},{id:4,section:"3",row:"1"},{id:5,section:"7",row:"1",watermarks:[H]},{id:6,section:"7",row:"2",watermarks:[H]},{id:7,section:"7",row:"3",watermarks:[H]},{id:8,section:"7",row:"4",watermarks:[H]},{id:9,section:"8",row:"1",watermarks:[Pe,H]}];var Ae=G(require("styled-components")),ot=Ae.default.div`
  display: flex;
  gap: 6px;
  align-items: center;
  min-width: 100px;

  .color {
    display: block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: red;
  }
`,Z=ot;var U=require("react/jsx-runtime"),rt=({color:e,name:t})=>(0,U.jsxs)(Z,{children:[(0,U.jsx)("div",{className:"color",style:{backgroundColor:e}}),(0,U.jsxs)("div",{children:["Row: ",t]})]}),ae=rt;var L=require("react/jsx-runtime"),nt=({color:e,name:t})=>(0,L.jsxs)(Z,{children:[(0,L.jsx)("div",{className:"color",style:{backgroundColor:e}}),(0,L.jsx)("div",{children:(0,L.jsxs)("div",{children:["Section: ",t]})})]}),ie=nt;var S=require("react/jsx-runtime"),at=({ticket:e,active:t,onClick:r,onHover:n})=>{let{watermarks:o}=e;return(0,S.jsxs)("div",{style:{margin:"10px 0",border:"2px solid transparent",borderColor:t?"red":"transparent",overflow:"auto"},onMouseEnter:()=>n({sectionName:e.section,rowName:e.row}),onMouseLeave:()=>n(void 0),onClick:()=>r({sectionName:e.section,rowName:e.row}),children:[(0,S.jsxs)("strong",{children:["Ticket ID: ",e.id]}),(0,S.jsxs)("div",{children:["Section: ",`${e.section}`]}),(0,S.jsxs)("div",{children:["Row: ",`${e.row}`]}),(0,S.jsxs)("div",{children:["Section ID: ",`${e.sectionId}`]}),(0,S.jsxs)("div",{children:["Row ID: ",`${e.rowId}`]}),o&&o.length>0&&o.sort((s,c)=>s.sortOrder-c.sortOrder).map(s=>(0,S.jsxs)("div",{style:{marginLeft:10,display:"flex",alignItems:"center",gap:6,fontSize:"12px"},children:[(0,S.jsx)("div",{style:{width:"10px",height:"10px",borderRadius:"50%",backgroundColor:s.color}}),(0,S.jsxs)("div",{children:[s.watermarkName," (",s.sortOrder,")"]})]},s.id))]})},se=at;var y=require("react/jsx-runtime"),it=({tickets:e,onHover:t,onClick:r,setToken:n,actionState:o,selectedTickets:s})=>{var c,a,i,m;return(0,y.jsxs)("div",{style:{width:"300px",height:"100%",borderRight:"3px dashed gray",overflow:"auto",fontSize:"12px"},children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("h4",{style:{fontSize:"16px",margin:"10px"},children:"Token"}),(0,y.jsx)("input",{type:"password",onChange:({target:{value:I}})=>n(I)})]}),(0,y.jsx)("h4",{style:{fontSize:"16px",margin:"10px"},children:"Tickets"}),(0,y.jsxs)("div",{children:[(0,y.jsx)("strong",{children:"Hover:"}),(0,y.jsxs)("div",{children:["Section: ",`${(c=o.hover)==null?void 0:c.sectionName}`]}),(0,y.jsxs)("div",{children:["Row: ",`${(a=o.hover)==null?void 0:a.rowName}`]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("strong",{children:"Focus:"}),(0,y.jsxs)("div",{children:["Section: ",`${(i=o.focus)==null?void 0:i.sectionName}`]}),(0,y.jsxs)("div",{children:["Row: ",`${(m=o.focus)==null?void 0:m.rowName}`]})]}),e.filter(I=>s.length?s.includes(I.id):!0).map(I=>{let w=!1,g=o.focus||o.hover;return g&&(!g.rowName&&I.section===g.sectionName||g.rowName===I.row&&g.sectionName===I.section)&&(w=!0),(0,y.jsx)(se,{active:w,ticket:I,onClick:r,onHover:t},I.id)})]})},ce=it;var K=require("react");var Ce=G(require("styled-components")),st=Ce.default.div`
  display: flex;
  gap: 8px;
`,Ne=st;var ct=(e,t)=>{let r=t.filter(s=>s.section===e.section),n=[],o=[];return r.forEach(s=>{var c;if((c=s.watermarks)!=null&&c.length)for(let a=0;a<s.watermarks.length;a++){let i=s.watermarks[a];n.includes(i.id)||(n.push(i.id),o.push(i))}}),o},be=e=>e!=null&&e.length?e.sort((t,r)=>t.sortOrder-r.sortOrder)[0].color:de,z=e=>{var r;let t={ticketsByIdMap:new Map,sectionDataByIdMap:new Map,rowDataByIdMap:new Map,watermarks:[],ticketsByWatermarkIdMap:new Map,watermarksByIdMap:new Map,sectionRowIdsByWatermarkIdMap:new Map};if(e!=null&&e.length)for(let n=0;n<e.length;n++){let o=e[n],s=ct(o,e);if(t.ticketsByIdMap.set(o.id,o),t.sectionDataByIdMap.set(o.sectionId,{color:be(s),sectionId:o.sectionId,rowId:o.rowId}),t.rowDataByIdMap.set(o.rowId,{color:be(o.watermarks),sectionId:o.sectionId,rowId:o.rowId}),(r=o.watermarks)!=null&&r.length)for(let c=0;c<o.watermarks.length;c++){let a=o.watermarks[c],i=t.ticketsByWatermarkIdMap.get(a.id);i?t.ticketsByWatermarkIdMap.set(a.id,[...i,o]):t.ticketsByWatermarkIdMap.set(a.id,[o]),t.watermarksByIdMap.has(a.id)||t.watermarksByIdMap.set(a.id,a);let m=t.sectionRowIdsByWatermarkIdMap.get(a.id);m?t.sectionRowIdsByWatermarkIdMap.set(a.id,{sectionIds:Array.from(new Set(o.sectionId?[...m.sectionIds,o.sectionId]:m.sectionIds)),rowIds:Array.from(new Set(o.rowId?[...m.rowIds,o.rowId]:m.rowIds))}):t.sectionRowIdsByWatermarkIdMap.set(a.id,{sectionIds:o.sectionId?[o.sectionId]:[],rowIds:o.rowId?[o.rowId]:[]})}}return t.watermarks=Array.from(t.watermarksByIdMap.values()),t};var W=require("react/jsx-runtime"),dt=({tickets:e,onSelect:t})=>{let[{watermarks:r},n]=(0,K.useState)(z(e)),o=c=>{c.preventDefault(),c.stopPropagation()},s=(c,a)=>{o(c),t(a)};return(0,K.useEffect)(()=>{n(z(e))},[e]),r.length?(0,W.jsx)(Ne,{children:r.map(c=>(0,W.jsxs)("button",{style:{backgroundColor:c.color,display:"flex",alignItems:"center",gap:4},onDoubleClick:o,onDoubleClickCapture:o,onClick:a=>s(a,c),children:[c.watermarkName," (",c.sortOrder,")"]},c.id))}):(0,W.jsx)(W.Fragment,{})},pe=dt;var Be=G(require("styled-components")),pt=Be.default.div`
  .level-wrapper {
    // padding: 14px;
    // margin-top: 30px;
    // &>button {
    //   font-size: 40px;
    // }
    background-color: red;
  }
`,Re=pt;var h=require("react/jsx-runtime"),de="#CABF93",mt=()=>{let[e,t]=(0,N.useState)(z(C)),[r,n]=(0,N.useState)({hover:void 0,focus:void 0,selected:[],selectedWatermark:void 0}),[o,s]=(0,N.useState)("section"),[c,a]=(0,N.useState)(""),i=(0,N.useMemo)(()=>{var d;return r.selectedWatermark?((d=e.ticketsByWatermarkIdMap.get(r.selectedWatermark.id))==null?void 0:d.map(l=>l.id))||[]:C.filter(l=>r.selected.some(p=>p.rowName?l.row===p.rowName&&l.section===p.sectionName:l.section===p.sectionName)).map(l=>l.id)},[r.selected,r.selectedWatermark]),m=(0,N.useMemo)(()=>C.map((d,l)=>{var T,V;let p=r.selectedWatermark&&((T=d.watermarks)!=null&&T.length)?d.watermarks.find(E=>{var D;return E.id===((D=r.selectedWatermark)==null?void 0:D.id)}):void 0,x=p||((V=d.watermarks)!=null&&V.length?d.watermarks.sort((E,D)=>(E.sortOrder||0)-(D.sortOrder||0))[0]:void 0),b=(x==null?void 0:x.color)||de;return{sectionName:d.section,rowName:d.row,inactiveStyles:{fillColor:p==null?void 0:p.color},sortOrder:(p==null?void 0:p.sortOrder)||void 0,rowTooltip:(0,h.jsx)(ae,{color:b,name:d.row}),sectionTooltip:(0,h.jsx)(ie,{color:b,name:d.section})}}),[C,r.selectedWatermark]),I=d=>{r!=null&&r.focus||n(l=>u(f({},l),{hover:d}))},w=d=>{n(l=>u(f({},l),{focus:JSON.stringify(d)===JSON.stringify(l.focus)?void 0:d,hover:void 0}))},g=d=>{console.log(d.length,C.length),n(l=>u(f({},l),{selected:d,selectedWatermark:void 0}))},Q=d=>{n(l=>{var p,x,b;return u(f({},l),{selected:((p=l.selectedWatermark)==null?void 0:p.id)===d.id?[]:((x=e.ticketsByWatermarkIdMap.get(d.id))==null?void 0:x.map(T=>u(f({},T),{sectionName:T.section,rowName:T.row})))||[],selectedWatermark:((b=l.selectedWatermark)==null?void 0:b.id)===d.id?void 0:d})})};return(0,h.jsxs)("div",{style:{display:"flex",height:"900px"},children:[(0,h.jsx)(ce,{tickets:C,selectedTickets:i,actionState:r,onHover:I,onClick:w,setToken:d=>a(d)}),(0,h.jsx)(Re,{style:{flex:"auto",height:"100%"},children:(0,h.jsx)($,{level:o,onLevelChange:s,venueLayoutId:560501,token:c,items:m,hoveredItem:r.hover||void 0,focusedItem:r.focus||void 0,selectedItems:r.selected||void 0,defaultExtraContentOptions:{levelWrapperClassName:"level-wrapper"},extraContent:{"bottom-left":{component:(0,h.jsx)(pe,{tickets:C,onSelect:Q})}},useShadeDown:["select"],useMapSelect:!0,onItemHover:d=>{I(d)},onItemClick:d=>{w(d)},onItemsSelect:(d,l)=>{console.log("map selection: ",d,l),g(l)},defaultItemStyles:{interactive:{inactive:{fillColor:"#CABF93",fillOpacity:1},active:{fillColor:"#CABF93",fillOpacity:1,color:"black",opacity:1,weight:2}},noninteractive:{fillColor:"lightgray"}}})})]})},me=mt;var Le=require("react/jsx-runtime");function De(){let e=document.getElementById("root");if(!e)throw new Error("Root element not found");We.default.createRoot(e).render((0,Le.jsx)(me,{}))}var lt=$;De();
